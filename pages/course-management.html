<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>课程管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom scrollbar */
        .table-container::-webkit-scrollbar {
            height: 10px;
            width: 10px;
        }
        .table-container::-webkit-scrollbar-track {
            background: #f8fafc;
            border-radius: 4px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 5px;
            border: 2px solid #f8fafc;
        }
        .table-container::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        .table-container {
            overflow: auto;
        }
        
        .text-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 40px;
            line-height: 20px;
            white-space: normal;
        }
    </style>
</head>
<body class="p-4 bg-gray-50 h-screen overflow-hidden font-sans text-gray-700 flex flex-col">
    <!-- Main Container -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 flex flex-col flex-1 h-full overflow-hidden">
        
        <!-- Filter Section -->
        <div class="flex flex-wrap items-center justify-between mb-3 gap-4 shrink-0">
            <!-- Left Side: Filters and Action Buttons -->
            <div class="flex flex-wrap items-center gap-3">
                <!-- College Custom Dropdown -->
                <div class="relative" id="college-dropdown">
                    <button id="college-select-btn" class="flex items-center justify-between w-44 bg-white border border-gray-300 text-gray-700 py-2 pl-4 pr-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm transition-shadow shadow-sm hover:border-gray-400">
                        <span id="college-select-text">请选择学院</span>
                        <i class="fas fa-chevron-down text-xs text-gray-400 transition-transform duration-200" id="college-select-icon"></i>
                    </button>
                    <!-- Dropdown Menu -->
                    <div id="college-options" class="hidden absolute top-full left-0 mt-1 w-full bg-white border border-gray-100 rounded-lg shadow-lg z-50 py-1 max-h-60 overflow-y-auto transform origin-top transition-all duration-200 opacity-0 scale-95">
                        <!-- Options will be generated by JS -->
                    </div>
                </div>

                <!-- Course Name Input -->
                <div class="relative">
                    <input type="text" id="search-input" placeholder="请输入课程名称" class="bg-white border border-gray-300 text-gray-700 py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-48 text-sm transition-shadow">
                </div>

                <!-- Action Buttons -->
                <button onclick="handleSearch()" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-5 rounded-lg text-sm transition-all duration-200 shadow-sm hover:shadow">
                    查询
                </button>
                <button onclick="handleReset()" class="bg-white hover:bg-gray-50 text-gray-700 border border-gray-300 font-medium py-2 px-5 rounded-lg text-sm transition-all duration-200 shadow-sm hover:shadow">
                    重置
                </button>
            </div>

            <!-- Right Side: New Button -->
            <button onclick="openAddModal()" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-5 rounded-lg text-sm transition-all duration-200 shadow-sm hover:shadow flex items-center">
                <i class="fas fa-plus mr-1"></i> 新增
            </button>
        </div>

        <!-- Table Section -->
        <div class="table-container flex-1 border border-gray-200 rounded-lg relative bg-white overflow-auto">
            <table class="min-w-max w-full divide-y divide-gray-200">
                <thead class="bg-gray-50 sticky top-0 shadow-sm z-30">
                    <tr>
                        <th scope="col" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider w-16">序号</th>
                        <th scope="col" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">课程代码</th>
                        <th scope="col" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">课程名称</th>
                        <th scope="col" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">课程性质</th>
                        <th scope="col" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">学分</th>
                        <th scope="col" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">所属学院</th>
                        <th scope="col" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider sticky right-0 bg-gray-50 z-20 shadow-[-5px_0_5px_-5px_rgba(0,0,0,0.1)]">操作</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200 text-sm" id="table-body">
                    <!-- Rows will be generated by JS -->
                </tbody>
            </table>
        </div>

        <!-- Pagination Section -->
        <div class="flex flex-wrap items-center justify-between pt-3 mt-auto shrink-0" id="pagination-container">
            <!-- Pagination will be generated by JS -->
        </div>
    </div>

    <!-- CRUD Modal -->
    <div id="crud-modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50 backdrop-blur-sm transition-opacity opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-96 transform scale-95 transition-transform duration-200" id="crud-modal-content">
            <div class="flex justify-between items-center p-5 border-b border-gray-100">
                <h3 class="text-lg font-bold text-gray-800" id="modal-title">新增课程</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">课程代码</label>
                    <input type="text" id="modal-code" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">课程名称</label>
                    <input type="text" id="modal-name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm">
                </div>
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">课程性质</label>
                        <select id="modal-nature" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm bg-white">
                            <option value="必修">必修</option>
                            <option value="选修">选修</option>
                            <option value="通识">通识</option>
                            <option value="专业课">专业课</option>
                            <option value="专业基础">专业基础</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1">学分</label>
                        <input type="number" id="modal-credits" step="0.5" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">所属学院</label>
                    <select id="modal-college" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all text-sm bg-white">
                        <!-- Options generated by JS -->
                    </select>
                </div>
                <input type="hidden" id="modal-mode"> <!-- add, edit -->
                <input type="hidden" id="modal-original-code"> <!-- for editing -->
            </div>
            <div class="p-5 border-t border-gray-100 flex justify-end gap-3">
                <button onclick="closeModal()" class="px-4 py-2 text-sm text-gray-600 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors font-medium">取消</button>
                <button onclick="saveData()" class="px-4 py-2 text-sm text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors font-medium shadow-sm hover:shadow">确定</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirm Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50 backdrop-blur-sm transition-opacity opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-80 transform scale-95 transition-transform duration-200" id="delete-modal-content">
            <div class="p-6 text-center">
                <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4 text-red-500">
                    <i class="fas fa-exclamation-triangle text-xl"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">确认删除</h3>
                <p class="text-gray-500 text-sm mb-6">您确定要删除该课程吗？此操作无法撤销。</p>
                <div class="flex justify-center gap-3">
                    <button onclick="closeDeleteModal()" class="px-4 py-2 text-sm text-gray-600 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors font-medium">取消</button>
                    <button onclick="confirmDelete()" class="px-4 py-2 text-sm text-white bg-red-500 hover:bg-red-600 rounded-lg transition-colors font-medium shadow-sm hover:shadow">删除</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Toast Notification -->
    <div id="success-toast" class="fixed top-4 right-4 bg-white border border-green-100 shadow-[0_8px_30px_rgb(0,0,0,0.12)] rounded-lg p-4 flex items-center gap-3 transform translate-x-[120%] transition-transform duration-300 z-[100]">
        <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-500 shrink-0">
            <i class="fas fa-check"></i>
        </div>
        <div>
            <h4 class="font-bold text-gray-800 text-sm">操作成功</h4>
            <p class="text-xs text-gray-500 mt-0.5" id="toast-message">操作成功</p>
        </div>
    </div>

    <script>
        // --- Mock Data ---
        const colleges = [
            '电子电气工程学院', '马克思主义学院', '工商管理学院', '外国语学院', 
            '化学化工学院', '艺术设计学院', '城市轨道交通学院', '理学院', '计算机学院'
        ];
        
        const natures = ['必修', '选修', '通识', '专业课', '专业基础'];
        
        let courseData = [];
        
        function initData() {
            const baseCourses = [
                { name: '高等数学', nature: '必修', credits: 4.0, college: '理学院' },
                { name: '大学英语', nature: '必修', credits: 3.0, college: '外国语学院' },
                { name: '计算机基础', nature: '通识', credits: 2.0, college: '计算机学院' },
                { name: '电路分析', nature: '专业课', credits: 4.5, college: '电子电气工程学院' },
                { name: '马克思主义原理', nature: '必修', credits: 3.0, college: '马克思主义学院' },
                { name: '工商管理概论', nature: '专业课', credits: 3.0, college: '工商管理学院' },
                { name: '无机化学', nature: '必修', credits: 4.0, college: '化学化工学院' },
                { name: '设计色彩', nature: '专业基础', credits: 3.0, college: '艺术设计学院' },
                { name: '轨道交通概论', nature: '专业课', credits: 2.0, college: '城市轨道交通学院' },
                { name: 'Python程序设计', nature: '选修', credits: 2.5, college: '计算机学院' },
                { name: '线性代数', nature: '必修', credits: 2.5, college: '理学院' },
                { name: '大学物理', nature: '必修', credits: 3.5, college: '理学院' },
                { name: '模拟电子技术', nature: '专业课', credits: 4.0, college: '电子电气工程学院' },
                { name: '数字电子技术', nature: '专业课', credits: 4.0, college: '电子电气工程学院' },
                { name: '管理学原理', nature: '专业基础', credits: 3.0, college: '工商管理学院' },
                { name: '会计学基础', nature: '专业基础', credits: 3.0, college: '工商管理学院' },
                { name: '有机化学', nature: '专业基础', credits: 4.0, college: '化学化工学院' },
                { name: '物理化学', nature: '专业基础', credits: 4.0, college: '化学化工学院' },
                { name: '平面构成', nature: '专业基础', credits: 3.0, college: '艺术设计学院' },
                { name: '立体构成', nature: '专业基础', credits: 3.0, college: '艺术设计学院' },
                { name: '城市轨道交通运营管理', nature: '专业课', credits: 3.0, college: '城市轨道交通学院' },
                { name: '城市轨道交通车辆', nature: '专业课', credits: 3.0, college: '城市轨道交通学院' },
                { name: 'Java程序设计', nature: '选修', credits: 3.0, college: '计算机学院' },
                { name: 'Web前端开发', nature: '选修', credits: 2.5, college: '计算机学院' },
                { name: '数据结构', nature: '专业课', credits: 3.5, college: '计算机学院' }
            ];

            courseData = baseCourses.map((c, i) => ({
                code: `KC${String(i + 1).padStart(3, '0')}`,
                ...c
            }));
        }

        initData();

        // --- State ---
        let currentPage = 1;
        let pageSize = 10;
        let filteredData = [...courseData];
        let selectedCollege = '';
        let deleteCode = null;

        // --- Dropdown Logic ---
        const dropdownBtn = document.getElementById('college-select-btn');
        const dropdownMenu = document.getElementById('college-options');
        const dropdownText = document.getElementById('college-select-text');
        const dropdownIcon = document.getElementById('college-select-icon');

        function renderDropdown() {
            dropdownMenu.innerHTML = '';
            
            // Default option
            const defaultOption = document.createElement('div');
            defaultOption.className = 'px-4 py-2 hover:bg-gray-50 cursor-pointer text-sm text-gray-700 transition-colors';
            defaultOption.setAttribute('data-value', '');
            defaultOption.textContent = '请选择学院';
            dropdownMenu.appendChild(defaultOption);

            // College options
            colleges.forEach(college => {
                const div = document.createElement('div');
                div.className = 'px-4 py-2 hover:bg-gray-50 cursor-pointer text-sm text-gray-700 transition-colors';
                div.setAttribute('data-value', college);
                div.textContent = college;
                dropdownMenu.appendChild(div);
            });

            // Also populate Modal Select
            const modalSelect = document.getElementById('modal-college');
            modalSelect.innerHTML = '';
            colleges.forEach(college => {
                const option = document.createElement('option');
                option.value = college;
                option.textContent = college;
                modalSelect.appendChild(option);
            });
        }

        dropdownBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleDropdown();
        });

        document.addEventListener('click', () => {
            closeDropdown();
        });

        function toggleDropdown() {
            const isHidden = dropdownMenu.classList.contains('hidden');
            if (isHidden) {
                dropdownMenu.classList.remove('hidden');
                void dropdownMenu.offsetWidth;
                dropdownMenu.classList.remove('opacity-0', 'scale-95');
                dropdownIcon.classList.add('rotate-180');
            } else {
                closeDropdown();
            }
        }

        function closeDropdown() {
            dropdownMenu.classList.add('opacity-0', 'scale-95');
            dropdownIcon.classList.remove('rotate-180');
            setTimeout(() => {
                dropdownMenu.classList.add('hidden');
            }, 200);
        }

        dropdownMenu.addEventListener('click', (e) => {
            e.stopPropagation();
            const option = e.target.closest('div[data-value]');
            if (!option) return;
            
            const value = option.getAttribute('data-value');
            selectedCollege = value || '';
            dropdownText.textContent = value || '请选择学院';
            dropdownText.classList.toggle('text-gray-700', !!value);
            dropdownText.classList.toggle('text-gray-500', !value);
            closeDropdown();
        });

        // --- Filter Logic ---
        function handleSearch() {
            const nameVal = document.getElementById('search-input').value.trim().toLowerCase();
            
            filteredData = courseData.filter(item => {
                const matchCollege = !selectedCollege || item.college === selectedCollege;
                const matchName = !nameVal || item.name.toLowerCase().includes(nameVal);
                return matchCollege && matchName;
            });
            
            currentPage = 1;
            renderTable();
            renderPagination();
        }

        function handleReset() {
            selectedCollege = '';
            document.getElementById('search-input').value = '';
            dropdownText.textContent = '请选择学院';
            dropdownText.classList.remove('text-gray-700');
            dropdownText.classList.add('text-gray-500');
            
            filteredData = [...courseData];
            currentPage = 1;
            renderTable();
            renderPagination();
        }

        // --- Render Logic ---
        function renderTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageData = filteredData.slice(start, end);
            
            pageData.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50 transition-colors duration-150 group';
                tr.innerHTML = `
                    <td class="px-3 py-3 text-center text-gray-500">${start + index + 1}</td>
                    <td class="px-3 py-3 text-center text-gray-800">${item.code}</td>
                    <td class="px-3 py-3 text-center text-gray-800 font-medium">${item.name}</td>
                    <td class="px-3 py-3 text-center text-gray-600">${item.nature}</td>
                    <td class="px-3 py-3 text-center text-gray-600">${item.credits.toFixed(1)}</td>
                    <td class="px-3 py-3 text-center text-gray-600">${item.college}</td>
                    <td class="px-3 py-3 text-center sticky right-0 bg-white group-hover:bg-gray-50 z-10 shadow-[-5px_0_5px_-5px_rgba(0,0,0,0.1)] transition-colors">
                        <div class="flex justify-center space-x-2">
                            <button onclick="openEditModal('${item.code}')" class="w-8 h-8 rounded-lg flex items-center justify-center text-green-500 bg-green-50 border border-green-200 hover:bg-green-100 transition-colors" title="编辑">
                                <i class="far fa-edit"></i>
                            </button>
                            <button onclick="openDeleteConfirm('${item.code}')" class="w-8 h-8 rounded-lg flex items-center justify-center text-red-500 bg-red-50 border border-red-200 hover:bg-red-100 transition-colors" title="删除">
                                <i class="far fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderPagination() {
            const container = document.getElementById('pagination-container');
            const totalItems = filteredData.length;
            const totalPages = Math.ceil(totalItems / pageSize);
            
            // Start of Pagination HTML
            let html = `
                <div class="text-sm text-gray-600 font-medium">
                    共 ${totalItems} 条
                </div>
                <div class="flex items-center space-x-3">
                    <div class="relative group">
                        <select onchange="handlePageSizeChange(this.value)" class="appearance-none bg-white border border-gray-300 text-gray-700 py-1.5 pl-3 pr-8 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 transition-shadow">
                            <option value="10" ${pageSize == 10 ? 'selected' : ''}>10条/页</option>
                            <option value="20" ${pageSize == 20 ? 'selected' : ''}>20条/页</option>
                            <option value="50" ${pageSize == 50 ? 'selected' : ''}>50条/页</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400 group-hover:text-blue-500 transition-colors">
                            <i class="fas fa-chevron-down text-xs"></i>
                        </div>
                    </div>

                    <div class="flex items-center space-x-1">
                        <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''} class="w-8 h-8 flex items-center justify-center rounded border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 hover:text-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-chevron-left text-xs"></i>
                        </button>
            `;

            // Page Numbers Logic
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    const isActive = i === currentPage;
                    html += `
                        <button onclick="changePage(${i})" class="w-8 h-8 flex items-center justify-center rounded border ${isActive ? 'border-blue-500 bg-blue-500 text-white font-medium shadow-sm' : 'border-gray-300 bg-white text-gray-600 hover:bg-gray-50 hover:text-blue-600 transition-colors'}">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    html += `<span class="w-8 h-8 flex items-center justify-center text-gray-400">...</span>`;
                }
            }

            html += `
                        <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''} class="w-8 h-8 flex items-center justify-center rounded border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 hover:text-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-chevron-right text-xs"></i>
                        </button>
                    </div>
                    
                    <div class="flex items-center text-sm text-gray-600 ml-2">
                        <span class="mr-2">跳至</span>
                        <input type="number" min="1" max="${totalPages}" onchange="changePage(this.value)" class="w-10 h-8 border border-gray-300 rounded text-center focus:outline-none focus:ring-1 focus:ring-blue-500 mx-1 transition-shadow" value="${currentPage}">
                        <span class="ml-1">页</span>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            page = parseInt(page);
            if (page < 1 || page > totalPages || page === currentPage) return;
            currentPage = page;
            renderTable();
            renderPagination();
        }

        function handlePageSizeChange(size) {
            pageSize = parseInt(size);
            currentPage = 1;
            renderTable();
            renderPagination();
        }

        // --- CRUD Logic ---
        const modal = document.getElementById('crud-modal');
        const modalContent = document.getElementById('crud-modal-content');
        const modalTitle = document.getElementById('modal-title');
        const modalCode = document.getElementById('modal-code');
        const modalName = document.getElementById('modal-name');
        const modalNature = document.getElementById('modal-nature');
        const modalCredits = document.getElementById('modal-credits');
        const modalCollege = document.getElementById('modal-college');
        const modalMode = document.getElementById('modal-mode');
        const modalOriginalCode = document.getElementById('modal-original-code');

        const deleteModal = document.getElementById('delete-modal');
        const deleteModalContent = document.getElementById('delete-modal-content');

        function openAddModal() {
            modalTitle.textContent = '新增课程';
            modalCode.value = '';
            modalName.value = '';
            modalNature.value = '必修';
            modalCredits.value = '3.0';
            modalCollege.value = colleges[0];
            modalCode.disabled = false;
            modalMode.value = 'add';
            showModal(modal, modalContent);
        }

        function openEditModal(code) {
            modalTitle.textContent = '编辑课程';
            const item = courseData.find(c => c.code === code);
            if (!item) return;

            modalCode.value = item.code;
            modalName.value = item.name;
            modalNature.value = item.nature;
            modalCredits.value = item.credits;
            modalCollege.value = item.college;
            
            modalCode.disabled = true;
            modalMode.value = 'edit';
            modalOriginalCode.value = code;
            
            showModal(modal, modalContent);
        }

        function showModal(m, c) {
            m.classList.remove('hidden');
            void m.offsetWidth;
            m.classList.remove('opacity-0');
            c.classList.remove('scale-95');
        }

        function closeModal() {
            modal.classList.add('opacity-0');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 200);
        }

        function showToast(message) {
            const toast = document.getElementById('success-toast');
            const toastMessage = document.getElementById('toast-message');
            toastMessage.textContent = message;
            toast.classList.remove('translate-x-[120%]');
            setTimeout(() => {
                toast.classList.add('translate-x-[120%]');
            }, 3000);
        }

        function saveData() {
            const code = modalCode.value.trim();
            const name = modalName.value.trim();
            const nature = modalNature.value;
            const credits = parseFloat(modalCredits.value);
            const college = modalCollege.value;
            const mode = modalMode.value;

            if (!code || !name || isNaN(credits)) {
                alert('请填写完整信息');
                return;
            }

            if (mode === 'add') {
                if (courseData.some(c => c.code === code)) {
                    alert('课程代码已存在');
                    return;
                }
                courseData.unshift({ code, name, nature, credits, college });
                showToast('课程信息新增成功');
            } else {
                const index = courseData.findIndex(c => c.code === modalOriginalCode.value);
                if (index !== -1) {
                    courseData[index] = { code, name, nature, credits, college };
                }
                showToast('课程信息修改成功');
            }

            handleSearch(); // Re-filter and render
            closeModal();
        }

        function openDeleteConfirm(code) {
            deleteCode = code;
            showModal(deleteModal, deleteModalContent);
        }

        function closeDeleteModal() {
            deleteModal.classList.add('opacity-0');
            deleteModalContent.classList.add('scale-95');
            setTimeout(() => {
                deleteModal.classList.add('hidden');
            }, 200);
            deleteCode = null;
        }

        function confirmDelete() {
            if (!deleteCode) return;
            
            const index = courseData.findIndex(c => c.code === deleteCode);
            if (index !== -1) {
                courseData.splice(index, 1);
            }
            
            handleSearch();
            closeDeleteModal();
            showToast('课程信息删除成功');
        }

        // Init
        renderDropdown();
        renderTable();
        renderPagination();
    </script>
</body>
</html>